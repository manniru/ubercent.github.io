function makeFileInput(e,t){if(e){var n=document.querySelector(".file-input-x42");n||(n=document.createElement("input"),n.type="file",n.accept="image/*",n.className="file-input-x42",n.style.position="fixed",n.style.top="-10000px",n.style.left="-10000px",n.style.opacity=0,document.body.appendChild(n),n.addEventListener("change",function(e){var o=n.files;o&&t(o[0])},!1)),e.addEventListener("click",function(e){var t=e.which||e.button;1===t&&(n.value=null,n.click())}.bind(this),!1)}}function makeFileDrop(e,t){function n(e){e.stopPropagation(),e.preventDefault()}function o(e){e.stopPropagation(),e.preventDefault();var n=e.dataTransfer,o=n.files;o.length>0?t(o[0]):n.getData("URL")&&console.log(n.getData("URL"))}e&&(document.body.addEventListener("dragenter",n,!1),document.body.addEventListener("dragexit",n,!1),document.body.addEventListener("dragover",n,!1),e.addEventListener("drop",o,!1))}!function(){function e(){if(n(),!i){var e=Account.getKeyPairFromStorage();i=e.public,t()}}function t(){if(window.qr){var e=$(".receive #qrCode");e.style.width="240px",e.style.height="240px",qr.image({image:e,value:i,size:10,level:"H"}),updateIdenticon($(".receive #identicon"),i);var t=encodeURIComponent(location.protocol+"//"+location.host+"/#send?s=bitcoin:"+i);$(".receive #publicKey").textContent=i,$(".receive #whatsapp").href="whatsapp://send?text="+t,$(".receive #email").href="mailto:?Subject=My Bitcoin Address&body="+t,$(".receive #copy").href="sms:&body="}}function n(){a=setInterval(function(){Account.fetchBalance(function(e){return c&&e!==c?location="/":void(c=e)})},1e4)}function o(){clearInterval(a)}var i,a,c;$(".page.receive").show=e,$(".page.receive").hide=o}(),function(){window.app={},app.showLoading=function(e){$("#loading").hidden=e===!1},app.scrollToTop=function(){document.activeElement&&document.activeElement.blur(),setTimeout(function(){document.body.scrollTop=0},0)}}(),function(){function e(e,t){var n=qr.image(e);n.onload=function(){t(n)}}function t(){u.fillStyle="#FFFFFF",u.fillRect(0,0,d.width,d.height),u.fillStyle="#EFEFEF",u.fillRect(0,0,d.width,d.width)}function n(e,t){u.font="13px sans-serif",u.textAlign="center",u.strokeText(t,150,280),u.save(),u.translate(284,284),u.rotate(-Math.PI/2),u.strokeText("ubercent.com",16,290),u.restore()}function o(t,n){e(t,function(e){u.drawImage(e,16,316,152,152),n()})}function i(){var e=new Image;e.onload=function(){u.drawImage(e,50,50,200,200)},updateIdenticon(e,l.public,200,[240,240,240,255])}function a(){var e="../images/touch/icon-72x72.png",t=new Image;t.onload=function(){u.save(),u.translate(16,80),u.rotate(-Math.PI/2),u.drawImage(t,236,421,64,64),u.restore()},t.src=e}function c(){v!==r&&(r=v,t(),n(s,v),i(),a(),o(s,function(){var e=d.toDataURL(),t=document.getElementById("dlLink");t.href=e}))}var r,d=document.getElementById("canvas"),u=d.getContext("2d"),l=Account.getKeyPairFromStorage(),s=l.private,v=l.public;$(".page.export").show=function(){setTimeout(c,500)}}(),function(){function e(e){var t=/^bitcoin:0x([a-zA-Z0-9]{40})(?:\?(.*))?$/,n=t.exec(e);if(!n)return null;var o={url:e};if(n[2])for(var i=n[2].split("&"),a=0;a<i.length;a++){var c=i[a].split("=");2==c.length&&(o[c[0]]=decodeURIComponent(c[1].replace(/\+/g,"%20")))}return o.address="0x"+n[1],o}function t(){var t=e(decodeURIComponent(location.hash.substr(8)));return t.amount&&(t.amount.indexOf("$")===-1?t.amount=Exchange.BTCtoUSD(t.amount):t.amount=t.amount.replace("$","")),t}function n(){a=t(),console.log(a);var e=$(".send #amount");a&&a.amount?e.value=a.amount:Device.iOS&&(e.value="0.01")}function o(e){var t=$(".send #balance");t.textContent=e}function i(){Account.fetchBalance(o),n(),a&&updateIdenticon($(".send #identicon"),a.address),setTimeout(function(){$(".send #amount").focus()},1e3)}var a;window.send=function(){app.scrollToTop(),app.showLoading();var e=$(".send #amount").value;$(".send button");e=Number(e),e=Exchange.USDtoBTC(e);var t=a.address;Wallet.spend(e,t,function(e,t){return e?void(location="/"):(alert(t?t:"An Error occured. Try again."),void app.showLoading(!1))})},$(".send").show=i}(),function(){function e(e){app.showLoading(),setTimeout(function(){app.scrollToTop(),window.resizeImage(e,qrcode.decode,512)},1)}function t(e,t){p=$("#qr-canvas"),p.style.width=e+"px",p.style.height=t+"px",p.width=e,p.height=t,m=p.getContext("2d"),m.clearRect(0,0,e,t)}function n(){if(1==g&&h)try{m.drawImage(y,0,0);try{qrcode.decode()}catch(e){console.log(e),f=setTimeout(n,200)}}catch(e){console.log(e),f=setTimeout(n,200)}}function o(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}function i(e){x=e,y.src=a(x),h=!0}function a(e){return window.webkitURL?window.webkitURL.createObjectURL(e):window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(e):null}function c(e){h=!1,d()}function r(){o()&&window.File&&window.FileReader?(t(800,600),qrcode.callback=l,u()):d()}function d(){$("#outdiv").innerHTML="Click here to scan a code",$(".scan .content").click()}function u(){function e(){t.getUserMedia?t.getUserMedia({video:{optional:[{sourceId:o}]},audio:!1},i,c):t.mediaDevices.getUserMedia?t.mediaDevices.getUserMedia({video:{facingMode:"environment",optional:[{sourceId:o}]},audio:!1}).then(i).catch(c):t.webkitGetUserMedia?(w=!0,t.webkitGetUserMedia({video:{optional:[{sourceId:o}]},audio:!1},i,c)):t.mozGetUserMedia?(b=!0,t.mozGetUserMedia({video:{optional:[{sourceId:o}]},audio:!1},i,c)):d(),g=1,f=setTimeout(n,200)}if(1==g)return void(f=setTimeout(n,200));var t=navigator;if($("#outdiv").innerHTML=T,y=$("#v"),!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return console.log("enumerateDevices() not supported."),void d();var o;navigator.mediaDevices.enumerateDevices().then(function(t){t.forEach(function(e){console.log(e.kind+": "+e.label+" id = "+e.deviceId),e.label.indexOf("back")>-1&&(o=e.deviceId,console.log("asd",o))}),e()}).catch(function(e){console.log(e.name+": "+e.message)})}function l(e){return console.log(e),e&&e.indexOf&&e.indexOf("error")!==-1?(app.showLoading(!1),alert(e)):(v(),s(),void setTimeout(function(){s();var t=/^[a-zA-Z0-9]{64}$/;return t.test(e)?(Account.setPrivateKey(e),location="/"):(e=e.replace("bitcoin:",""),void(location="#send?s=bitcoin:"+e))},200))}function s(){navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&navigator.vibrate(100)}function v(){g=0,window.mediaStream&&mediaStream.stop&&mediaStream.stop(),x&&x.getTracks&&x.getTracks()[0]&&x.getTracks()[0].stop(),clearTimeout(f),y.src=null}var f,m=null,p=null,g=0,h=!1,w=!1,b=!1,y=null,x=null,T='<video id="v" autoplay height="100%" width="100%"></video>';$(".scan .content").addEventListener("click",function(){clearTimeout(f)}),makeFileInput($(".scan .content"),e),makeFileDrop(document.body,e),$(".scan").show=function(){setTimeout(r,800)},$(".scan").hide=function(){v()}}(),function(){function e(e){var t=$("#balance");t.textContent=e}function t(){var t=Account.getKeyPairFromStorage();Account.fetchBalance(e),updateIdenticon($("#identicon"),t.public)}$("header").onclick=function(){location="#scan"},t()}();